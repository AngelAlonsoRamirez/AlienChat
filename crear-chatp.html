<html><head>
  <meta charset="UTF-8">
  <script>
  var usuario = ""
  </script>
  <script src='/sdcard/Android/data/com.alienchat/files/Alienchat/user.txt'></script>
  <script src='/sdcard/Android/data/com.smartphoneremote.androidscriptfree/files/AlienChat/user.txt'></script>

<title>Crear Chat</title>
  <script src="https://use.fontawesome.com/e63bef178e.js"></script>
  <script src='file:///android_asset/app.js'></script>
  <script src='video.js'></script>
  <script src='web.js'></script>
  <script src='codigo-per.js'></script>
  <link rel="stylesheet" href="estilo.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="chat-container">
  <ul class="chat-feed">

<div id="todo">
<input type="image" id="logos" src="Img/home.png" onclick="location.href='index.html'" name="submit" width="50" height="50"/>
<input type="image" id="logos" src="Img/videos.png" onclick="video()" name="submit" width="50" height="50"/>
<input type="image" id="logos" src="Img/web.png" onclick="web()" name="submit" width="50" height="50"/>
<input type="image" id="logos" src="Img/codigo.png" onclick="numero()" name="submit" width="50" height="50"/>
</div>

  </ul>
<div id="arriba">
      <textarea placeholder="EscrÃ­be un mensaje..." id='message'></textarea>


<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
  
    <script>
    function _0x3480(){var _0x2fe109=['alienchat-15c3e.appspot.com','10IjkfTj','82362BcnVVh','40skILJB','https://alienchat-15c3e.firebaseio.com','1:868864500942:web:c98cf6b253fe5bd6659c9f','497fmUnzs','initializeApp','61112sPVitE','868864500942','15760704GoiPMV','alienchat-15c3e','2417780rhqkiv','CreateCrypt','AIzaSyCku7zr-X0rUCJuicLfrGX-2Ps_N33yEnk','8305QgMpwb','alienchat-15c3e.firebaseapp.com','8380rRfysd','22992sOFigc','93073nzfcbJ','828uhajtY'];_0x3480=function(){return _0x2fe109;};return _0x3480();}var _0x449f7b=_0x4f40;(function(_0x4ebfda,_0x12d397){var _0x4624a3=_0x4f40,_0xe718f3=_0x4ebfda();while(!![]){try{var _0xb1bbc7=-parseInt(_0x4624a3(0x1d9))/0x1*(-parseInt(_0x4624a3(0x1dc))/0x2)+parseInt(_0x4624a3(0x1d8))/0x3*(-parseInt(_0x4624a3(0x1de))/0x4)+parseInt(_0x4624a3(0x1d2))/0x5+parseInt(_0x4624a3(0x1dd))/0x6*(parseInt(_0x4624a3(0x1cc))/0x7)+-parseInt(_0x4624a3(0x1ce))/0x8*(-parseInt(_0x4624a3(0x1da))/0x9)+parseInt(_0x4624a3(0x1d7))/0xa*(-parseInt(_0x4624a3(0x1d5))/0xb)+-parseInt(_0x4624a3(0x1d0))/0xc;if(_0xb1bbc7===_0x12d397)break;else _0xe718f3['push'](_0xe718f3['shift']());}catch(_0x43614f){_0xe718f3['push'](_0xe718f3['shift']());}}}(_0x3480,0x935d4),crypt=app[_0x449f7b(0x1d3)]());var pass='AlienChat',config={'apiKey':_0x449f7b(0x1d4),'authDomain':_0x449f7b(0x1d6),'databaseURL':_0x449f7b(0x1df),'projectId':_0x449f7b(0x1d1),'storageBucket':_0x449f7b(0x1db),'messagingSenderId':_0x449f7b(0x1cf),'appId':_0x449f7b(0x1cb),'measurementId':'G-MYEF5EERR5'};function _0x4f40(_0x52af1f,_0x15a85e){var _0x348019=_0x3480();return _0x4f40=function(_0x4f40d2,_0x4d6ac9){_0x4f40d2=_0x4f40d2-0x1cb;var _0x3bb53d=_0x348019[_0x4f40d2];return _0x3bb53d;},_0x4f40(_0x52af1f,_0x15a85e);}firebase[_0x449f7b(0x1cd)](config);  
    var servidor="Img"

if (usuario == null) {
    app.Alert("Tu nombre de usuario no es valido.", "ERROR","", 180 );
    location.href = "ajustes.html"
    }

if (usuario == '') {
    app.Alert("Tu nombre de usuario no es valido.", "ERROR","", 180 );
    location.href = "ajustes.html"
    }

const db = firebase.database();
const chatForm = document.querySelector('form');
const textBox = document.querySelector('textarea');
const chats = document.querySelector('ul');

var d = new Date();
var ramdom = Math.floor(Math.random() * 100*5);
var codigo = d.getDate() + d.getDay() + d.getFullYear() + d.getHours() + d.getMinutes() + d.getSeconds() + d.getTime() * ramdom

var code= d.getDate() + "" + (d.getMonth() +1) + "" + d.getFullYear()


var chat = 'ChatPrivado/Permanente/' + "/" + codigo
const sessionId = usuario

const bot = '00000000000'
const chatsRef = db.ref('/' + chat);
  const mensajeId = Date.now();
  var d = new Date();
    var f = new Date();
  var tiempo = d.getHours() + ":" + d.getMinutes()
  var fecha = d.getDate() + "/" + (d.getMonth() +1) + "/" + d.getFullYear() + " <small>" + d.getHours() + ":" + d.getMinutes() + "</small>"

    var txt = "<b><img style='border-radius: 6px;' src=\'" + servidor + "/abot.png\'width=\'70px\' height=\'70px\'><i><font color=\'red\'> Alienbot</font></b></i> <br><i>" + fecha + "</i><br>El usuario " + name  + " a creado un chat permanente<br>" + codigo
    var encriptbot = crypt.Encrypt( txt, pass )

  db.ref(chat + '/' + mensajeId).set({
    id: bot,
    mensaje: encriptbot
  });

function handleSubmit(e) {
  e.preventDefault();
  
  if (!textBox.value) {
    return;
  }
    const mensajeId = Date.now();
  var d = new Date();
  var tiempo = d.getDate() + "/" + (d.getMonth() +1) + "/" + d.getFullYear() + " <small>" + d.getHours() + ":" + d.getMinutes() + "</small>"
  textBox.value = textBox.value.replace(/</gi,"");
  textBox.value = textBox.value.replace(/>/gi,"");


    var txt = "<b>" + usuario + "</b> <br><i>" + tiempo + '</i><br>' + textBox.value
    
    var encript = crypt.Encrypt( txt, pass )


  db.ref(chat + '/' + mensajeId).set({
    id: sessionId,
    mensaje: encript
  });
  
  textBox.value = '';
}

chatsRef.on('child_added', handleChildAdded);

function handleChildAdded(data) {
  const mensajeData = data.val();
  const li = document.createElement('li');
  
  li.innerHTML = mensajeData.mensaje;
  
  li.innerHTML = crypt.Decrypt( mensajeData.mensaje, pass )



  if (mensajeData.id !== sessionId) {
  li.classList.add('other');
  }
  
  chats.appendChild(li);
  
  chats.scrollTop = chats.scrollHeight;
}

textBox.addEventListener('keydown', handleKeyDown);

function handleKeyDown(e) {
  if (e.which == 13) {
    handleSubmit(e);
  }
}
</script>
<body></html>